<app-navbar></app-navbar>

<div class="max-w-[95%] xl:max-w-[83%] mx-auto pb-12 relative">

  <div class="sticky top-20 z-30 w-full mb-8 rounded-b-3xl border-x border-b border-surface-200/50 bg-white/80 backdrop-blur-md shadow-sm transition-all duration-300">
    <div class="px-6 py-4 flex flex-col sm:flex-row items-center justify-between gap-4">

      <h1 class="text-xl sm:text-2xl text-surface-900 tracking-tight flex items-center gap-2">
        <span class="bg-primary-50 text-primary-600 px-3 py-1 rounded-xl font-bold border border-primary-100 shadow-sm">
          {{ foundProducts.totalProducts }}
        </span>
        <span class="font-bold">resultados</span>
        <ng-container *ngIf="searchQuery">
          <span class="text-surface-400 font-light mx-1">|</span>
          <span class="text-surface-600">búsqueda:</span>
          <span class="italic font-bold text-surface-900">"{{ searchQuery }}"</span>
        </ng-container>
      </h1>

      <div class="hidden sm:flex items-center gap-3">
        <label for="sort-by" class="text-sm font-bold text-surface-500 uppercase tracking-wider">Ordenar:</label>
        <p-select
          [options]="sortOptions"
          [(ngModel)]="selectedSortOption"
          (onChange)="onSortChange()"
          optionLabel="name"
          placeholder="Seleccionar"
          styleClass="!border-surface-200 !rounded-xl !bg-surface-50 hover:!bg-white hover:!border-primary-300 transition-colors w-48 shadow-sm"
        ></p-select>
      </div>

      <p-button (click)="visibleDrawer = true" label="Filtrar y Ordenar" icon="pi pi-filter" styleClass="xl:hidden !rounded-xl !font-bold w-full sm:w-auto" />
    </div>
  </div>

  <div class="grid grid-cols-1 xl:grid-cols-[280px_1fr] gap-8 items-start">

    <aside class="hidden xl:block sticky top-44 self-start">
      <div class="bg-white p-6 rounded-3xl shadow-sm border border-surface-200">
        <div class="flex items-center gap-2 mb-6 pb-4 border-b border-surface-100">
          <i class="pi pi-sliders-h text-primary-500"></i>
          <h2 class="font-bold text-lg text-surface-900">Filtrar por</h2>
        </div>

        <div class="flex flex-col gap-4">
          <h3 class="font-bold text-sm text-surface-500 uppercase tracking-wider mb-1">Categorías</h3>

          <div *ngFor="let category of categories" class="flex items-center group cursor-pointer py-1">
            <p-checkbox
              [inputId]="category.id"
              name="group"
              [value]="category"
              [(ngModel)]="selectedCategories"
              (onChange)="onCategoryChange($event)"
              styleClass="mr-3" />
            <label [for]="category.id" class="text-surface-700 cursor-pointer group-hover:text-primary-600 transition-colors font-medium text-sm">
              {{ category.name }}
            </label>
          </div>

          <div *ngIf="!categories.length" class="text-surface-400 italic text-sm py-4 text-center bg-surface-50 rounded-xl">
            No hay filtros disponibles.
          </div>
        </div>
      </div>
    </aside>

    <section class="flex flex-col gap-6 w-full">

      <p-drawer header="Filtros y Orden" [(visible)]="visibleDrawer" position="right" styleClass="!w-full sm:!w-96 !bg-surface-50 !mt-20">
        <div class="flex flex-col h-full overflow-y-auto px-1 py-4 gap-8">
          <div class="bg-white p-4 rounded-2xl shadow-sm border border-surface-200 sm:hidden">
            <h3 class="font-bold text-sm text-surface-900 mb-3">Ordenar por</h3>
            <p-select
              [options]="sortOptions"
              [(ngModel)]="selectedSortOption"
              (onChange)="onSortChange()"
              optionLabel="name"
              styleClass="w-full !rounded-xl"
            ></p-select>
          </div>

          <div class="bg-white p-4 rounded-2xl shadow-sm border border-surface-200">
            <h3 class="font-bold text-sm text-surface-900 mb-4">Categorías</h3>
            <div class="flex flex-col gap-3">
              <div *ngFor="let category of categories" class="flex items-center">
                <p-checkbox [inputId]="category.id + '_mobile'" name="group" [value]="category" [(ngModel)]="selectedCategories" (onChange)="onCategoryChange($event)" />
                <label [for]="category.id + '_mobile'" class="ml-3 text-surface-700 font-medium"> {{ category.name }} </label>
              </div>
              <div *ngIf="!categories.length" class="text-slate-500">No hay categorías disponibles.</div>
            </div>
          </div>
        </div>
        <ng-template pTemplate="footer">
          <p-button (click)="visibleDrawer = false" label="Ver resultados" styleClass="w-full !rounded-xl !font-bold"></p-button>
        </ng-template>
      </p-drawer>

      <ng-container *ngIf="!loading && !error && foundProducts.products.length; else noProducts">
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4 auto-rows-fr">
          <ng-template ngFor let-product [ngForOf]="foundProducts.products">
            <div class="h-full">
              <app-product-card [product]="product" [elementId]="'search-prod-' + product.id" class="h-full block"></app-product-card>
            </div>
          </ng-template>
        </div>
      </ng-container>

      <ng-template #noProducts>
        <div class="w-full">
          <app-loading [loading]="loading" [error]="error" [numElements]="foundProducts.products.length" elementsType="productos que coincidan con la búsqueda"></app-loading>

          <div *ngIf="!loading && !error" class="bg-white rounded-3xl p-12 text-center border border-surface-200 shadow-sm mt-4">
            <div class="w-20 h-20 bg-surface-50 rounded-full flex items-center justify-center mx-auto mb-4">
              <i class="pi pi-search text-3xl text-surface-400"></i>
            </div>
            <h3 class="text-xl font-bold text-surface-900 mb-2">No hemos encontrado nada</h3>
            <p class="text-surface-500">Prueba con otros términos o elimina los filtros seleccionados.</p>
          </div>
        </div>
      </ng-template>

      <div class="flex justify-center items-center mt-8 p-2 bg-white border border-surface-200 rounded-3xl shadow-sm max-w-fit mx-auto" *ngIf="foundProducts.totalProducts > 0">
        <p-paginator
          (onPageChange)="onPageChange($event)"
          [first]="first"
          [rows]="rows"
          [totalRecords]="foundProducts.totalProducts"
          [rowsPerPageOptions]="[10, 20, 30]"
          styleClass="!border-none !bg-transparent"
        ></p-paginator>
      </div>

    </section>
  </div>
</div>

<app-footer></app-footer>
