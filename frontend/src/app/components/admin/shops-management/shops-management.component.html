<div class="min-h-screen bg-slate-50 font-sans text-slate-800">

  <div class="max-w-[95%] xl:max-w-[83%] mx-auto p-4 py-8">

    <div class="mb-8 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
      <div>
        <h1 class="text-3xl font-bold text-yellow-600">Gestor de Tiendas</h1>
        <p class="text-slate-500">Administra las diferentes puntos de venta de la organización.</p>
      </div>

      <div>
        <p-button routerLink="/admin/shops/new" label="Nueva Tienda" icon="pi pi-plus" styleClass="p-button-warning" rounded="true"></p-button>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-5 gap-6 mb-8">

      <div class="lg:col-span-3 bg-white border border-slate-200 rounded-2xl shadow-sm overflow-hidden flex flex-col h-[400px] lg:h-[500px] relative">
        <div class="absolute top-4 left-4 z-[400] bg-white/90 backdrop-blur-sm px-3 py-1.5 rounded-lg border border-slate-200 shadow-sm">
          <h3 class="font-bold text-slate-700 text-xs flex items-center gap-2">
            <i class="pi pi-map text-green-600"></i> Distribución de tiendas
          </h3>
        </div>

        <div id="map" class="flex-grow w-full min-h-0 bg-slate-100"></div>
      </div>

      <div class="lg:col-span-2 bg-white border border-slate-200 rounded-2xl shadow-sm p-5 flex flex-col h-full">

        <div class="flex items-center gap-5 p-6 bg-slate-50 border border-slate-100 rounded-xl mb-6 relative overflow-hidden shrink-0">
          <div class="absolute -right-6 -top-6 w-24 h-24 bg-yellow-100 rounded-full blur-xl opacity-60"></div>

          <div class="w-16 h-16 shrink-0 bg-white rounded-full shadow-sm flex items-center justify-center z-10 border border-slate-100">
            <i class="pi pi-shop text-3xl text-yellow-500" style="font-size: 1.5rem"></i>
          </div>

          <div class="flex flex-col z-10">
            <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">Tiendas Totales</span>

            <div class="flex items-center gap-3 mt-1">
              <span class="text-4xl font-extrabold text-slate-800">{{ totalRecords }}</span>
            </div>
          </div>
        </div>

        <div class="flex-grow flex flex-col min-h-0">
          <div class="flex justify-between items-center mb-3 shrink-0">
            <h3 class="font-bold text-slate-700 text-sm">Notificaciones relacionadas</h3>
            <!-- <button class="text-[10px] text-cyan-600 font-bold hover:underline">Ver todos</button> -->
          </div>

          <div class="flex flex-col gap-2 overflow-y-auto max-h-[380px] pr-1 custom-scrollbar">

            @for(alert of shopAlerts(); track $index) {
              <div class="group flex items-center gap-3 p-2.5 rounded-lg border border-slate-100 bg-white hover:border-slate-200 hover:shadow-sm transition-all cursor-pointer">
                <div class="shrink-0 w-8 h-8 rounded-full flex items-center justify-center"
                     [ngClass]="{
                    'bg-red-50 text-red-500': alert.severity === 'high',
                    'bg-yellow-50 text-yellow-500': alert.severity === 'medium',
                    'bg-cyan-50 text-cyan-500': alert.severity === 'info'
                 }">
                  <i [class]="alert.icon"></i>
                </div>

                <div class="flex-grow min-w-0">
                  <p class="text-xs font-bold text-slate-700 truncate">{{ alert.shopName }}</p>
                  <p class="text-[10px] text-slate-500 truncate">{{ alert.message }}</p>
                </div>

                <div class="opacity-0 group-hover:opacity-100 transition-opacity">
                  <i class="pi pi-chevron-right text-xs text-slate-300"></i>
                </div>
              </div>
            }
          </div>
        </div>
      </div>
    </div>

    <div class="bg-white border border-slate-200 rounded-2xl overflow-hidden shadow-sm flex flex-col">

      <div class="p-4 border-b border-slate-200 bg-slate-50 flex flex-col sm:flex-row justify-between items-center gap-4">
        <h3 class="text-xl font-bold text-slate-800">Todas las tiendas (3)</h3>
        <div class="flex gap-2 w-full sm:w-auto">
          <p-inputgroup>
            <input pInputText placeholder="Buscar..." />
            <p-inputgroup-addon>
              <p-button icon="pi pi-search" severity="secondary" variant="text"/>
            </p-inputgroup-addon>
          </p-inputgroup>
        </div>
      </div>

      <p-table #dt
               [value]="shops()"
               [rows]="rows"
               selectionMode="single"
               [(selection)]="selectedShop"
               styleClass="p-datatable-sm"
               responsiveLayout="scroll">

        <ng-template pTemplate="header">
          <tr class="bg-slate-50 text-slate-700 text-sm uppercase tracking-wider border-b border-slate-200">
            <th class="font-semibold">Ref</th>
            <th class="font-semibold">Tienda</th>
            <th class="font-semibold">Dirección</th>
            <th class="font-semibold">Productos totales</th>
            <th class="font-semibold">Camiones asignados</th>
            <th class="font-semibold">Acciones</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-shop>
          <tr [pSelectableRow]="shop" class="hover:bg-slate-50 transition-colors border-b border-slate-100 last:border-0 group">
            <td class="pl-4 font-mono text-xs text-slate-500">{{ shop.referenceCode }}</td>

            <td class="font-bold text-slate-800 text-sm py-3">
              {{ shop.name }}
            </td>

            <td class="text-sm text-slate-600">
              <i class="pi pi-map-marker text-slate-300 mr-1 md:hidden"></i>{{ shop.fullAddress }}
            </td>

            <td class="text-center">
                        <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-50 text-green-700 border border-green-100">
                            {{ shop.productsCount }} items
                        </span>
            </td>

            <td class="text-center">
              <div class="flex items-center justify-start gap-1">
                <i class="pi pi-truck text-slate-400 text-xs"></i>
                <span class="text-sm font-bold text-slate-700">{{ shop.trucksCount }}</span>
              </div>
            </td>

            <td class="text-right pr-4">
              <div class="flex justify-start gap-2">
                <p-button icon="pi pi-map-marker" (click)="locateShopOnMap(shop); $event.stopPropagation()" styleClass="p-button-xs p-button-outlined p-button-info" rounded="true" pTooltip="Ver en Mapa"></p-button>
                <p-button icon="pi pi-cog" pTooltip="Administrar Tienda" (onClick)="onManageShop(shop)" styleClass="p-button-xs p-button-outlined p-button-secondary" rounded="true"></p-button>
                <p-button icon="pi pi-pencil" styleClass="p-button-xs p-button-outlined p-button-warning" rounded="true" pTooltip="Editar Tienda"></p-button>
                <p-button icon="pi pi-trash" pTooltip="Eliminar tienda" styleClass="p-button-xs p-button-outlined p-button-danger" rounded="true"></p-button>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr><td colspan="6" class="text-center p-4 text-slate-400">No hay tiendas disponibles.</td></tr>
        </ng-template>
      </p-table>

      <p-paginator [rows]="rows" [totalRecords]="totalRecords" [dropdownAppendTo]="'body'" styleClass="border-t border-slate-200 bg-slate-50 text-sm rounded-b-2xl"></p-paginator>
    </div>

  </div>
</div>
